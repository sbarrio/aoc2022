10 CLS : IF VDP(10) = 2 THEN HZ! = 50 ELSE HZ! = 60
20 TIME = 0
30 ' Initial problem data input
30 READ CL! : DIM CO$(CL!)
40 FOR I! = 1 TO CL! 
50    READ C$: CO$(I!) = C$
60 NEXT 
70 GOSUB 300

80 ' Main loop - read next move -> process crate stack changes
80 A! = 0: O! = 0: T!= 0: X1$ = "" : X2$ = "": XR$ = "" : L2! = 0
90 GOTO 200
100 'P = Index from which we cut the stack in half, X1 = Bottom part of stack, X2 = Top part of stack
100 P! = LEN(CO$(O!)) - A!
110 X1$ = LEFT$(CO$(O!), P!)
115 X2$ = RIGHT$(CO$(O!), A!)
116 CO$(O!) = X1$ 
117 LT! = LEN(CO$(T!)) :L2! = LEN(X2$)
118 'PRINT "Target " CO$(T!) " len " LT! " Append "  X2$ " len " L2!
119 'Append Top part of stack to target stack, in reverse order
120 XR$ = SPACE$(LT! + L2!) : LR! = LEN(XR$)
121 MID$(XR$, 1) = CO$(T!) 
122 'PRINT "Append target to XR-"XR$"-LEN " LR!
123 'Reverse top part of string
123 GOSUB 150
124 MID$(XR$, LT! + 1) = X2$
125 'PRINT "Append top to XR-"XR$"-FROM " LT!
126 CO$(T!) = XR$
127 GOSUB 300
128 GOTO 80

150 'Reverse X2$
151 SW$ = SPACE$(L2!): 
152 FOR S! = 0 TO L2! - 1
153   C$ =  MID$(X2$, L2! - S!, 1)
154   MID$(SW$, S! + 1) = C$
155 NEXT
156 X2$ = SW$
157 RETURN 

200 ' Read move
210 READ A!
220 IF A! = -1 THEN GOTO 400
230 READ O! : READ T!
235 PRINT "MOVE IS " A! O! T!
240 GOTO 100

300 PRINT "Crate stack status:"
310 FOR X! = 1 TO CL!
320     PRINT X! "- " CO$(X!)
330 NEXT
340 RETURN
 
400 R$ = SPACE$(CL!)
401 FOR R! = 1 TO CL!
402  R1$ = RIGHT$(CO$(R!), 1)
403  MID$(R$, R!) = R1$
404 NEXT
405 PRINT "Result: " R$
406 PRINT "Ran in " TIME / HZ! "sec." : STOP

500 DATA 9
501 DATA "ZPMHR"
502 DATA "PCJB"
503 DATA "SNHGLCD"
504 DATA "FTMDQSRL"
505 DATA "FSPQBTZM"
506 DATA "TFSZBG"
507 DATA "NRV"
508 DATA "PGLTDVCM"
509 DATA "WQNJFML"
520 DATA 7,3,9
521 DATA 5,8,9
522 DATA 3,9,5
523 DATA 6,9,2
524 DATA 9,9,3
525 DATA 3,7,3
526 DATA 8,2,3
527 DATA 9,3,1
528 DATA 11,3,8
529 DATA 5,6,9
530 DATA 1,6,3
531 DATA 1,2,7
532 DATA 1,4,8
533 DATA 1,3,9
534 DATA 4,4,3
535 DATA 6,8,3
536 DATA 2,8,2
537 DATA 4,9,3
538 DATA 3,2,5
539 DATA 2,5,4
540 DATA 5,3,4
541 DATA 11,1,4
542 DATA 1,7,6
543 DATA 1,3,5
544 DATA 2,1,9
545 DATA 1,1,4
546 DATA 7,5,8
547 DATA 21,4,6
548 DATA 6,6,2
549 DATA 6,8,9
550 DATA 5,8,5
551 DATA 2,2,7
552 DATA 4,3,7
553 DATA 1,2,6
554 DATA 1,2,5
555 DATA 2,2,7
556 DATA 4,3,7
557 DATA 1,4,6
558 DATA 9,5,3
559 DATA 7,3,4
560 DATA 7,7,3
561 DATA 7,4,1
562 DATA 8,3,5
563 DATA 1,3,5
564 DATA 3,8,2
565 DATA 2,2,9
566 DATA 13,9,4
567 DATA 5,5,3
568 DATA 4,7,6
569 DATA 1,7,4
570 DATA 2,4,2
571 DATA 3,3,4
572 DATA 2,5,2
573 DATA 6,1,7
574 DATA 1,2,8
575 DATA 1,3,8
576 DATA 1,1,6
577 DATA 1,3,4
578 DATA 1,2,6
579 DATA 24,6,1
580 DATA 3,2,3
581 DATA 3,3,5
582 DATA 2,8,6
583 DATA 2,5,4
584 DATA 3,5,1
585 DATA 7,4,8
586 DATA 3,8,9
587 DATA 2,9,5
588 DATA 2,6,3
589 DATA 1,9,8
590 DATA 5,7,5
591 DATA 2,3,1
592 DATA 1,7,1
593 DATA 7,4,7
594 DATA 2,4,8
595 DATA 6,8,6
596 DATA 3,6,9
597 DATA 10,5,1
598 DATA 7,7,1
599 DATA 1,4,9
600 DATA 1,6,3
601 DATA 2,9,7
602 DATA 1,4,2
603 DATA 1,9,5
604 DATA 1,8,5
605 DATA 39,1,8
606 DATA 1,2,5
607 DATA 2,6,9
608 DATA 3,9,5
609 DATA 3,1,6
610 DATA 1,7,2
611 DATA 1,3,2
612 DATA 2,6,2
613 DATA 3,2,3
614 DATA 1,6,2
615 DATA 1,1,8
616 DATA 3,1,2
617 DATA 3,2,4
618 DATA 2,4,5
619 DATA 2,3,8
620 DATA 8,5,2
621 DATA 8,8,2
622 DATA 15,2,7
623 DATA 1,1,5
624 DATA 25,8,7
625 DATA 2,2,4
626 DATA 2,4,3
627 DATA 1,8,4
628 DATA 2,4,6
629 DATA 1,2,1
630 DATA 26,7,2
631 DATA 15,2,1
632 DATA 7,8,9
633 DATA 10,1,6
634 DATA 10,7,2
635 DATA 1,8,1
636 DATA 5,9,8
637 DATA 1,8,9
638 DATA 2,6,9
639 DATA 3,7,1
640 DATA 1,7,1
641 DATA 5,9,2
642 DATA 1,3,1
643 DATA 9,6,3
644 DATA 1,6,1
645 DATA 4,2,4
646 DATA 3,4,8
647 DATA 1,4,1
648 DATA 9,3,1
649 DATA 1,7,6
650 DATA 9,2,5
651 DATA 14,1,6
652 DATA 1,3,8
653 DATA 5,2,6
654 DATA 8,1,8
655 DATA 6,6,8
656 DATA 14,6,7
657 DATA 1,1,7
658 DATA 10,5,4
659 DATA 11,8,5
660 DATA 15,7,1
661 DATA 4,5,6
662 DATA 4,8,9
663 DATA 6,5,3
664 DATA 1,6,9
665 DATA 1,1,6
666 DATA 1,5,8
667 DATA 2,6,2
668 DATA 6,1,5
669 DATA 1,5,8
670 DATA 2,5,4
671 DATA 9,2,9
672 DATA 13,9,8
673 DATA 1,2,1
674 DATA 1,4,8
675 DATA 3,3,1
676 DATA 2,4,5
677 DATA 2,1,5
678 DATA 1,9,3
679 DATA 17,8,1
680 DATA 3,3,2
681 DATA 4,5,1
682 DATA 2,2,4
683 DATA 1,6,1
684 DATA 1,2,8
685 DATA 4,4,6
686 DATA 1,5,9
687 DATA 5,6,8
688 DATA 1,5,4
689 DATA 1,5,6
690 DATA 3,8,6
691 DATA 8,4,5
692 DATA 32,1,7
693 DATA 11,7,6
694 DATA 8,5,3
695 DATA 3,8,7
696 DATA 6,3,9
697 DATA 4,3,8
698 DATA 5,8,2
699 DATA 1,8,5
700 DATA 11,6,3
701 DATA 1,5,2
702 DATA 2,8,6
703 DATA 12,7,8
704 DATA 2,6,2
705 DATA 2,6,4
706 DATA 5,2,5
707 DATA 8,7,2
708 DATA 2,7,1
709 DATA 2,7,6
710 DATA 5,5,4
711 DATA 5,4,7
712 DATA 5,8,2
713 DATA 2,9,7
714 DATA 5,8,4
715 DATA 2,7,3
716 DATA 2,9,3
717 DATA 3,7,9
718 DATA 1,1,8
719 DATA 2,6,1
720 DATA 2,9,8
721 DATA 1,7,8
722 DATA 1,2,5
723 DATA 1,7,9
724 DATA 7,4,3
725 DATA 3,3,6
726 DATA 5,8,6
727 DATA 3,9,5
728 DATA 16,3,1
729 DATA 2,9,1
730 DATA 7,1,8
731 DATA 1,1,2
732 DATA 5,8,2
733 DATA 12,1,4
734 DATA 1,3,5
735 DATA 1,2,9
736 DATA 1,9,4
737 DATA 4,6,5
738 DATA 5,6,1
739 DATA 1,6,5
740 DATA 1,1,4
741 DATA 1,4,7
742 DATA 1,3,7
743 DATA 9,4,6
744 DATA 2,7,8
745 DATA 1,3,4
746 DATA 2,8,9
747 DATA 4,8,4
748 DATA 4,2,8
749 DATA 2,9,7
750 DATA 2,7,8
751 DATA 10,2,4
752 DATA 1,2,1
753 DATA 5,4,7
754 DATA 1,1,3
755 DATA 3,8,7
756 DATA 6,7,2
757 DATA 3,2,7
758 DATA 1,6,7
759 DATA 5,5,8
760 DATA 4,1,3
761 DATA 4,3,1
762 DATA 8,4,2
763 DATA 1,3,2
764 DATA 2,7,2
765 DATA 2,6,3
766 DATA 4,7,2
767 DATA 4,5,7
768 DATA 14,2,7
769 DATA 3,2,1
770 DATA 3,8,2
771 DATA 1,5,7
772 DATA 6,2,4
773 DATA 2,2,7
774 DATA 2,3,6
775 DATA 6,8,2
776 DATA 4,6,4
777 DATA 2,6,9
778 DATA 4,4,2
779 DATA 2,4,8
780 DATA 10,7,2
781 DATA 18,2,6
782 DATA 2,2,6
783 DATA 2,9,2
784 DATA 2,8,5
785 DATA 1,2,9
786 DATA 1,2,9
787 DATA 1,5,7
788 DATA 1,2,6
789 DATA 2,9,2
790 DATA 6,7,3
791 DATA 7,6,8
792 DATA 5,7,2
793 DATA 1,7,4
794 DATA 1,5,7
795 DATA 4,8,7
796 DATA 5,2,3
797 DATA 1,7,5
798 DATA 2,2,8
799 DATA 9,4,3
800 DATA 13,6,8
801 DATA 10,3,1
802 DATA 1,5,2
803 DATA 3,6,8
804 DATA 5,1,2
805 DATA 1,1,8
806 DATA 2,4,3
807 DATA 17,8,6
808 DATA 5,6,3
809 DATA 3,1,2
810 DATA 9,6,5
811 DATA 2,6,8
812 DATA 5,5,9
813 DATA 3,9,8
814 DATA 3,1,3
815 DATA 3,7,5
816 DATA 6,5,8
817 DATA 7,2,4
818 DATA 1,6,3
819 DATA 1,1,5
820 DATA 4,4,5
821 DATA 2,2,9
822 DATA 3,1,3
823 DATA 4,5,8
824 DATA 1,4,5
825 DATA 6,8,7
826 DATA 1,5,2
827 DATA 4,9,2
828 DATA 2,5,9
829 DATA 2,1,8
830 DATA 2,4,9
831 DATA 6,7,5
832 DATA 3,5,2
833 DATA 3,2,5
834 DATA 10,8,3
835 DATA 2,8,5
836 DATA 3,2,5
837 DATA 6,5,1
838 DATA 4,5,6
839 DATA 1,7,5
840 DATA 23,3,7
841 DATA 2,5,9
842 DATA 2,1,5
843 DATA 2,6,3
844 DATA 6,3,1
845 DATA 1,1,7
846 DATA 4,3,1
847 DATA 1,8,5
848 DATA 2,9,2
849 DATA 3,3,8
850 DATA 2,6,8
851 DATA 12,1,3
852 DATA 1,9,7
853 DATA 3,5,9
854 DATA 9,3,8
855 DATA 1,1,7
856 DATA 1,9,4
857 DATA 3,3,6
858 DATA 3,2,1
859 DATA 3,8,6
860 DATA 1,4,2
861 DATA 1,2,9
862 DATA 1,2,7
863 DATA 20,7,5
864 DATA 3,7,3
865 DATA 3,1,3
866 DATA 5,8,1
867 DATA 5,1,5
868 DATA 4,5,2
869 DATA 3,2,6
870 DATA 3,8,7
871 DATA 1,2,6
872 DATA 2,8,6
873 DATA 2,7,5
874 DATA 2,3,6
875 DATA 12,5,1
876 DATA 6,5,7
877 DATA 12,6,8
878 DATA 4,9,3
879 DATA 4,5,8
880 DATA 3,1,5
881 DATA 4,7,4
882 DATA 3,5,9
883 DATA 7,1,6
884 DATA 1,1,3
885 DATA 6,7,6
886 DATA 1,1,3
887 DATA 10,3,6
888 DATA 10,6,2
889 DATA 2,9,5
890 DATA 4,6,5
891 DATA 9,6,1
892 DATA 16,8,7
893 DATA 3,8,7
894 DATA 1,8,1
895 DATA 7,2,1
896 DATA 1,5,9
897 DATA 1,6,1
898 DATA 2,2,1
899 DATA 3,1,4
900 DATA 1,6,8
901 DATA 7,4,1
902 DATA 1,8,2
903 DATA 22,1,8
904 DATA 18,7,9
905 DATA 6,5,2
906 DATA 2,2,7
907 DATA 2,1,5
908 DATA 4,7,6
909 DATA 1,5,6
910 DATA 2,8,2
911 DATA 3,2,6
912 DATA 1,5,6
913 DATA 15,9,6
914 DATA 6,9,5
915 DATA 1,9,8
916 DATA 1,2,9
917 DATA 5,5,9
918 DATA 9,8,6
919 DATA 3,2,7
920 DATA 12,8,9
921 DATA 1,7,5
922 DATA 1,5,7
923 DATA 3,7,1
924 DATA 17,6,3
925 DATA 1,2,6
926 DATA 2,1,4
927 DATA 16,6,4
928 DATA 7,4,6
929 DATA 1,5,7
930 DATA 8,4,5
931 DATA 9,9,8
932 DATA 16,3,7
933 DATA 1,1,5
934 DATA 3,5,1
935 DATA 5,6,2
936 DATA 3,1,7
937 DATA 3,6,7
938 DATA 3,9,3
939 DATA 5,8,5
940 DATA 11,5,7
941 DATA 2,3,7
942 DATA 1,2,1
943 DATA 1,3,6
944 DATA 17,7,9
945 DATA 1,3,2
946 DATA 3,4,6
947 DATA 1,1,2
948 DATA 1,6,4
949 DATA 14,7,6
950 DATA 15,9,6
951 DATA 4,8,7
952 DATA 1,4,7
953 DATA 7,9,5
954 DATA 5,2,9
955 DATA 7,5,1
956 DATA 3,1,7
957 DATA 29,6,4
958 DATA 1,2,4
959 DATA 18,4,2
960 DATA 3,1,4
961 DATA 1,1,7
962 DATA 18,2,4
963 DATA 3,6,5
964 DATA 15,4,1
965 DATA 1,5,1
966 DATA 1,5,4
967 DATA 9,4,1
968 DATA 5,1,3
969 DATA 9,1,5
970 DATA 2,4,3
971 DATA 5,5,6
972 DATA 3,7,9
973 DATA 7,7,5
974 DATA 6,4,6
975 DATA 2,3,7
976 DATA 6,5,8
977 DATA 2,8,4
978 DATA 1,8,9
979 DATA 9,6,2
980 DATA 3,9,3
981 DATA 1,2,1
982 DATA 6,7,4
983 DATA 2,2,8
984 DATA 3,9,5
985 DATA 5,4,8
986 DATA 1,6,9
987 DATA 1,3,1
988 DATA 1,3,4
989 DATA 1,6,5
990 DATA 1,9,3
991 DATA 10,8,7
992 DATA 3,9,2
993 DATA 7,2,4
994 DATA 6,5,7
995 DATA 4,5,8
996 DATA 7,3,2
997 DATA 3,7,1
998 DATA 9,1,5
999 DATA 5,7,9
1000 DATA 7,1,4
1001 DATA 11,4,2
1002 DATA 4,8,3
1003 DATA 5,4,7
1004 DATA 4,4,1
1005 DATA 1,3,6
1006 DATA 12,7,4
1007 DATA 2,1,8
1008 DATA 5,9,7
1009 DATA 7,5,6
1010 DATA 1,1,4
1011 DATA 1,9,8
1012 DATA 1,4,7
1013 DATA 1,8,9
1014 DATA 5,7,9
1015 DATA 2,7,5
1016 DATA 2,6,3
1017 DATA 5,2,7
1018 DATA 1,7,8
1019 DATA 1,1,6
1020 DATA 3,5,1
1021 DATA -1