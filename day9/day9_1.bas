5 SCREEN 0: KEYOFF: WIDTH 80: MAXFILES = 1
10 CLS: DEFINT A-Z: HX = 0: HY = 0: TX = 0: TY = 0: OX = 40: OY = 12: DIM VP!(5000): TC = 0: L = 0: FL$ ="data.txt"
12 IF VDP(10) = 2 THEN HZ = 50 ELSE HZ = 60 : TIME = 0
15 OPEN FL$ FOR INPUT AS #1
20 INPUT #1, R$: L = L + 1: CLS: PRINT "Line: "L" Move: "R$" TC" TC
30 IF R$ = "*" GOTO 100
40 RR$ = LEFT$(R$,1): A = VAL(MID$(R$,2))
45 GOSUB 470
50 IF RR$ = "U" THEN EN = HY - A: ST = -1: GOSUB 120
60 IF RR$ = "R" THEN EN = HX + A: ST = 1: GOSUB 125
70 IF RR$ = "L" THEN EN = HX - A: ST = -1: GOSUB 125
80 IF RR$ = "D" THEN EN = HY + A: ST = 1 : GOSUB 120
90 GOTO 20
100 PRINT "Head:"HX","HY"Tail:"TX","TY"VIS:"TC
105 CLOSE #1
107 PRINT "Ran in "TIME / HZ "sec."
110 STOP

120 ' Up, Down
121 FOR J = HY TO EN STEP ST
122   HY = J: GOSUB 450: GOSUB 470
123 NEXT
124 RETURN

125 ' Right, Left
126 FOR I = HX TO EN STEP ST
127  HX = I: GOSUB 450: GOSUB 470
128 NEXT
129 RETURN

450 ' Update tail pos
450 DX = ABS(HX - TX): DY = ABS(HY - TY): PX = TX: PY = TY
452 ' Up, Down, Right, Left
452 IF DX >= 2 AND HY = TY AND HX > TX THEN TX = HX + 1: RX = HX: RY = HY: GOSUB 480: RETURN
453 IF DX >= 2 AND HY = TY AND HX < TX THEN TX = HX - 1: RX = HX: RY = HY: GOSUB 480: RETURN
454 IF DY >= 2 AND HX = TX AND HY > TY THEN TY = HY + 1: RX = HX: RY = HY: GOSUB 480: RETURN
455 IF DY >= 2 AND HX = TX AND HY < TY THEN TY = HY - 1: RX = HX: RY = HY: GOSUB 480: RETURN
456 'Only diagonals are possible beyond this point
456 IF HX = TX OR HY = TY THEN RETURN
457 ' Top right
457 IF TX = HX - 1 AND TY = HY - 2 THEN TX = HX: TY = HY - 1: GOSUB 500: RETURN
458 IF TX = HX - 2 AND TY = HY - 1 THEN TX = HX - 1: TY = HY: GOSUB 500: RETURN
459 ' Top left
459 IF TX = HX + 1 AND TY = HY - 2 THEN TX = HX: TY = HY - 1: GOSUB 500: RETURN
460 IF TX = HX + 2 AND TY = HY - 1 THEN TX = HX + 1: TY = HY: GOSUB 500: RETURN
461 ' Bottom right
461 IF TX = HX - 1 AND TY = HY + 2 THEN TX = HX: TY = HY + 1: GOSUB 500: RETURN
462 IF TX = HX - 2 AND TY = HY + 1 THEN TX = HX - 1: TY = HY: GOSUB 500: RETURN
463 ' Bottom left
463 IF TX = HX + 1 AND TY = HY + 2 THEN TX = HX: TY = HY + 1: GOSUB 500: RETURN
464 IF TX = HX + 2 AND TY = HY + 1 THEN TX = HX + 1: TY = HY: GOSUB 500: RETURN
465 RETURN

470 ' Print rope
470 H1 = HX + OX: H2 = HY + OY
471 IF H1 >= 80 OR H2 >= 24 OR H1 <= 0 OR H2 <= 0 THEN PRINT "Out of bounds "HX","HY" "TX","TY: RETURN
472 CLS: LOCATE H1, H2: PRINT "H"
473 LOCATE TX + OX, TY + OY: PRINT "T"
474 RETURN

480 ' Mark RX, RY as visited
481 HS! = RX * 1000 + RY
482 FOR Z = 1 TO TC
483   IF VP!(Z) = HS! THEN RETURN
484 NEXT
485 TC = TC + 1: VP!(TC) = HS!
486 RETURN

500 ' Mark horizontal row of positions as visited FROM PX,PY to TX,TY
501 SX = 1: SY = 1: IF PX < TX THEN SX = -1: IF PY < TY THEN SY = -1
502 FOR X=TX TO PX STEP SX
503  FOR Y=TY TO PY STEP SY
504    RX = X: RY = Y: GOSUB 480
505  NEXT
506 NEXT    
507 RETURN 
